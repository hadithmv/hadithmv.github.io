let showAyahNumbers=!0,showQuranBrackets=!0;document.addEventListener("DOMContentLoaded",(function(){document.getElementById("toggleAyahNumbers").addEventListener("click",(function(){showAyahNumbers=!showAyahNumbers,document.querySelectorAll("td").forEach((e=>{const t=e.textContent;t.match(/﴿.*﴾/)&&(showAyahNumbers?e.dataset.originalText&&(e.textContent=e.dataset.originalText):t.match(/﴿(.*?)\s[\u0660-\u0669]+﴾/)&&(e.dataset.originalText=t,e.textContent=t.replace(/\s[\u0660-\u0669]+﴾/,"﴾")))})),this.innerHTML=`&nbsp; އާޔަތް ނަމްބަރު ${showAyahNumbers?"ފޮރުވާ":"ދައްކާ"} &nbsp;`})),document.getElementById("toggleQuranBrackets").addEventListener("click",(function(){showQuranBrackets=!showQuranBrackets,document.querySelectorAll("td").forEach((e=>{const t=e.textContent;(t.match(/﴿.*﴾/)||e.dataset.originalWithBrackets)&&(showQuranBrackets?e.textContent=`﴿${e.textContent}﴾`:(e.dataset.originalWithBrackets=t,e.textContent=t.replace(/[﴿﴾]/g,"")))})),this.innerHTML=`&nbsp; އާޔަތް ބްރެކެޓް ${showQuranBrackets?"ފޮރުވާ":"ދައްކާ"} &nbsp;`}))}));let currentSurah=1,currentAyah=1,currentJuz=1,currentFocus=-1,additionalColumns=[],defaultColumns=[0],translationStates={},initialTranslationStates={},lastFocusedItems={surah:-1,ayah:-1,juz:-1},searchInputValues={surah:"",ayah:"",juz:""};const baseJsonUrl="../js/json/",maxSurah=114,maxJuz=30,baseColumns=[{data:"0",title:"ޖުޒް",visible:!1},{data:"1",title:"ސޫރަތް",visible:!1},{data:"2",title:"އާޔަތް #",visible:!1},{data:"3",title:"ބިސްމި",visible:!0},{data:"4",title:"އާޔަތް (އިމްލާއީ)",visible:!0,render:function(e,t,n){return replaceDigitsWithArabic("﴿"+e.replace(/\s([\u0660-\u0669]+)/," ")+" "+n[2]+"﴾")}},{data:"5",title:"ރަސްމު އުޘްމާނީ",visible:!1,render:function(e,t,n){return replaceDigitsWithArabic("﴿"+e.replace(/\s([\u0660-\u0669]+)/," ")+" "+n[2]+"﴾")}}],additionalJsons=[{name:"quranHadithmv",columns:[0],title:"ޙަދީޘްއެމްވީ ތަރުޖަމާ:"},{name:"quranRasmee",columns:[0,1],title:"ރަސްމީ ތަރުޖަމާ:"},{name:"quranBakurube",columns:[0,1],title:"ބަކުރުބެގެ ތަރުޖަމާ:"},{name:"quranJaufar",columns:[0,1],title:"ޖަޢުފަރުގެ ތަފްސީރު:"},{name:"quranSoabuni",columns:[0,1,2,3],title:"ޞގެ ތަފްސީރު:"},{name:"quranMukhtasar",columns:[0],title:"مختصر التفسير:"},{name:"quranMuyassar",columns:[0],title:"التفسير الميسر:"}];function replaceDigitsWithArabic(e){return e.replace(/[0-9]/g,(function(e){return arabicDigits[e]}))}function removeDiacritics(e){return e.replace(/[َُِّْٰۡۚٓـًٌٍّٔ]/g,"")}function prepareArabicText(e){return normalizeChars(e=(e=removeDiacritics(e)).replace(/سورة|سوره/g,"").replace(/^ال/g,"").trim())}defaultAdditionalJson=currentFileName;const charNormalizationMap={"أ":"ا","آ":"ا","إ":"ا","ٱ":"ا","ؤ":"و","ة":"ه","ئ":"ى","ޘ":"ސ","ޙ":"ހ","ޛ":"ޒ","ޜ":"ޒ","ޞ":"ސ","ޠ":"ތ","ޡ":"ޒ","ޢ":"އ","ޤ":"ގ","ޥ":"ވ"};function normalizeChars(e){return e.split("").map((e=>charNormalizationMap[e]||e)).join("")}function QtoggleDropdown(e){var t=$(`#${e}Dropdown`);if($(".q-dropdown").not(t).hide(),t.toggle().is(":visible")){var n=parseInt($(`#${e}Value`).text());const a=t.find(".q-dropdown-item");(n=a.filter(`[data-value="${n}"]`)).length&&(currentFocus=a.index(n),n[0].scrollIntoView({block:"center"}),removeActive(a),n.addClass("active")),t.find(".q-dropdown-search").val(searchInputValues[e]).focus()}}function QnavigateArrow(e,t){if("surah"===e)var n=currentSurah,a=114;else"ayah"===e?(n=currentAyah,a=ayahCounts[currentSurah]||1):"juz"===e&&(n=currentJuz,a=30);"prev"===t?1>--n&&("ayah"===e?(currentSurah--,1>currentSurah&&(currentSurah=114),updateAyahDropdown(),n=ayahCounts[currentSurah]||1):n=a):++n>a&&("ayah"===e&&(currentSurah++,114<currentSurah&&(currentSurah=1),updateAyahDropdown()),n=1),updateQValue(e,n)}function navigateToVerse(){const e=table.rows().indexes().filter((e=>(e=table.row(e).data(),null!==currentJuz?parseInt(e[0])===currentJuz:null!==currentSurah&&null!==currentAyah&&parseInt(e[1])===currentSurah&&parseInt(e[2])===currentAyah)));if(0<e.length){var t=table.page.info();table.page(Math.floor(e[0]/t.length)).draw(!1),(t=table.row(e[0]).node())&&t.scrollIntoView({behavior:"smooth",block:"center"}),updateAllQValues(table.row(e[0]).data())}}function updateQValue(e,t){t=parseInt(t);const n=$(`#${e}Value`);switch(e){case"surah":n.text(`${t} ${arabicSurahNames[t]}`),currentSurah=t,currentAyah=1,initializeQDropdown("ayah",1,ayahCounts[currentSurah]),$("#ayahValue").text(currentAyah),currentJuz=null;break;case"ayah":currentAyah=t,n.text(t),currentJuz=null;break;case"juz":currentJuz=t,n.text(t),currentAyah=currentSurah=null}navigateToVerse(),e=$(`#${e}Dropdown`).find(".q-dropdown-item"),currentFocus=e.index(e.filter(`[data-value="${t}"]`))}function updateAllQValues(e){currentJuz=parseInt(e[0]),currentSurah=parseInt(e[1]),currentAyah=parseInt(e[2]),$("#juzValue").text(currentJuz),$("#surahValue").text(`${currentSurah} ${arabicSurahNames[currentSurah]}`),$("#ayahValue").text(currentAyah)}function updateAyahDropdown(){initializeQDropdown("ayah",1,ayahCounts[currentSurah]||1),$("#ayahValue").text("1")}function initializeQDropdown(e,t,n){const a=$(`#${e}Dropdown`);for(a.empty(),a.append(`<input type="text" class="q-dropdown-search" placeholder="${"ސޫރަތް:"===a.closest(".q-nav-box").find(".q-nav-label").text()?"ސޫރަތުގެ ނަން ނުވަތަ ނަމްބަރު ލިޔޭ":"އާޔަތް:"===a.closest(".q-nav-box").find(".q-nav-label").text()?"އާޔަތް ނަމްބަރު ލިޔޭ":"ޖުޒް ނަމްބަރު ލިޔޭ"}">`),"ayah"===e&&(n=ayahCounts[currentSurah]);t<=n;t++){let n=t;"surah"===e&&(n=`${t} ${arabicSurahNames[t]} ${dhivehiSurahNames[t]} ${englishSurahNames[t]}`),a.append(`<div class="q-dropdown-item" data-value="${t}">${n}</div>`)}a.on("click",".q-dropdown-item",(function(){const t=$(this).data("value");updateQValue(e,t),lastFocusedItems[e]=a.find(".q-dropdown-item").index(this),a.hide()})),(n=a.find(".q-dropdown-search")).on("input",(function(){const e=prepareArabicText(this.value.toLowerCase()).split(/\s+/);a.find(".q-dropdown-item").each((function(){const t=$(this),n=prepareArabicText(t.text().toLowerCase());e.every((e=>n.includes(e)))?t.show():t.hide()})),currentFocus=-1})),n.on("keydown",(function(e){const t=a.find(".q-dropdown-item:visible"),n=t.length;if(0!==n){switch(e.keyCode){case 40:e.preventDefault(),currentFocus=0>currentFocus?0:Math.min(currentFocus+1,n-1);break;case 38:e.preventDefault(),currentFocus=Math.max(currentFocus-1,0);break;case 13:return e.preventDefault(),0>currentFocus&&0<n&&(currentFocus=0),void(0<=currentFocus&&currentFocus<n&&t.eq(currentFocus).click())}removeActive(t),0<=currentFocus&&(t.eq(currentFocus).addClass("active"),t[currentFocus].scrollIntoView({block:"nearest"}))}}))}function addActive(e){if(!e)return!1;removeActive(e),$(e[currentFocus]).addClass("active"),$(e[currentFocus])[0].scrollIntoView({block:"nearest",inline:"nearest"})}function removeActive(e){e.removeClass("active")}function initializeNavigationBoxes(){initializeQDropdown("surah",1,114),initializeQDropdown("juz",1,30),updateAyahDropdown(),$(".q-nav-value").on("click",(function(){QtoggleDropdown($(this).attr("id").replace("Value",""))})),$(".q-nav-arrow").on("click",(function(){QnavigateArrow($(this).data("type"),$(this).data("direction"))})),$(document).on("click",(function(e){$(e.target).closest(".q-nav-box").length||$(".q-dropdown").hide()})),$(".q-dropdown").on("hide",(function(){var e=$(this).attr("id").replace("Dropdown","");searchInputValues[e]=$(this).find(".q-dropdown-search").val()}))}function getAllColumnDefinitions(){const e=additionalJsons.flatMap((e=>[{title:`<strong>${e.title}</strong>`,data:null,name:`${e.name}-title`,visible:!1,render:function(t,n,a){return`<strong>${e.title}</strong>`}},...e.columns.map(((t,n)=>({title:`${n+1}`,data:null,name:`${e.name}-${t}`,visible:!1,render:function(n,a,r){return r[e.name]&&void 0!==r[e.name][t]?""===r[e.name][t]?"":r[e.name][t].replace(/\n/g,"<br>"):"ތައްޔާރުވަނީ..."}})))]));return[...baseColumns,...e]}function toggleTranslation(e,t){var n=additionalJsons.find((t=>t.name===e));const a=getColumnIndices(e),r=a[0],o=a[t+1],i=table.page();additionalColumns.includes(e)?(n=n.columns.filter(((e,t)=>table.column(a[t+1]).visible())),table.column(r).visible(!(1===n.length&&t===n[0]-1)),table.column(o).visible(!table.column(o).visible()),table.draw(),table.page(i).draw("page")):(additionalColumns.push(e),$.getJSON(`${baseJsonUrl}${e}.json`,(function(t){const n=table.data().toArray();n.forEach(((n,a)=>{n[e]=t[a]})),originalData=originalData.map(((n,a)=>((n=Array.isArray(n)?[...n]:Object.values(n))[e]=t[a],n))),table.clear().rows.add(n).draw(),table.column(r).visible(!0),table.column(o).visible(!0),table.page(i).draw("page")})).fail((function(e,t,n){console.error("Error loading translation:",n)})))}function getColumnIndices(e){let t=baseColumns.length;for(let n=0;n<additionalJsons.length&&additionalJsons[n].name!==e;n++)t+=additionalJsons[n].columns.length+1;return[t,...additionalJsons.find((t=>t.name===e)).columns.map(((e,n)=>t+n+1))]}function showAllTranslations(){document.querySelectorAll('#translationList input[type="checkbox"]').forEach((e=>{e.checked=!0,translationStates[e.value]=!0}))}function initializeTranslationSelector(){const e=document.getElementById("translationList"),t=document.getElementById("translationToggleBtn"),n=document.getElementById("translationDropdown"),a=document.getElementById("applyTranslations"),r=document.getElementById("resetTranslations"),o=document.getElementById("showAllTranslations"),i=document.getElementById("showMainTranslations");t&&n?(baseColumns.forEach(((t,n)=>{addTranslationItem(e,t.title,n,t.visible)})),additionalJsons.forEach((t=>{t.columns.forEach(((n,a)=>{addTranslationItem(e,`${t.title} ${a+1}`,`${t.name}-${n}`,t.name===defaultAdditionalJson&&0===a)}))})),t.addEventListener("click",(e=>{e.stopPropagation(),n.style.display="block"===n.style.display?"none":"block"})),document.addEventListener("click",(e=>{e.target.closest(".translation-selector")||"block"!==n.style.display||(applyTranslations(),n.style.display="none")})),a.addEventListener("click",(()=>{applyTranslations(),n.style.display="none"})),r.addEventListener("click",resetTranslations),o.addEventListener("click",showAllTranslations),i.addEventListener("click",showMainTranslations)):console.error("Toggle button or dropdown not found")}function showMainTranslations(){const e="ބިސްމި;އާޔަތް (އިމްލާއީ);ރަސްމީ ތަރުޖަމާ: 1;ބަކުރުބެގެ ތަރުޖަމާ: 2;ޖަޢުފަރުގެ ތަފްސީރު: 1;ޞގެ ތަފްސީރު: 2".split(";");document.querySelectorAll('#translationList input[type="checkbox"]').forEach((t=>{const n=t.nextElementSibling.textContent.trim();t.checked=e.includes(n),translationStates[t.value]=t.checked}))}function addTranslationItem(e,t,n,a){const r=document.createElement("div");if(r.className="translation-item",!String(n).includes("-title")){let o=!1;if("string"==typeof n&&n.includes("-")){const[e,t]=n.split("-");o=e===defaultAdditionalJson&&defaultColumns.includes(parseInt(t))}r.innerHTML=`\n      <input type="checkbox" id="trans-${n}" value="${n}" ${a||o?"checked":""}>\n      <label for="trans-${n}">${t}</label>\n    `,e.appendChild(r),translationStates[n]=a||o,initialTranslationStates[n]=a||o}}function applyTranslations(){const e=table.page();document.querySelectorAll('#translationList input[type="checkbox"]').forEach((e=>{const t=e.value;if(e=e.checked,"string"==typeof t&&t.includes("-")){const[n,a]=t.split("-");e!==table.column(getColumnIndices(n)[parseInt(a)+1]).visible()&&toggleTranslation(n,parseInt(a))}else table.column(parseInt(t)).visible(e);translationStates[t]=e})),additionalJsons.forEach((e=>{var t=getColumnIndices(e.name);e=t[0],t=t.slice(1).some((e=>table.column(e).visible())),table.column(e).visible(t)})),table.draw(),table.page(e).draw("page"),scrollUpTop()}function resetTranslations(){document.querySelectorAll('#translationList input[type="checkbox"]').forEach((e=>{e.checked=initialTranslationStates[e.value]||!1}))}function toggleBaseColumn(e){const t=table.column(e);t.visible(translationStates[e]),baseColumns[e].visible=t.visible()}