let showAyahNumbers=!0,showQuranBrackets=!0;function toggleAyahNumbers(){showAyahNumbers=!showAyahNumbers,document.querySelectorAll("td").forEach((t=>{const e=t.textContent;e.match(/﴿.*﴾/)&&(showAyahNumbers?t.dataset.originalText&&(t.textContent=t.dataset.originalText):e.match(/﴿(.*?)\s[\u0660-\u0669]+﴾/)&&(t.dataset.originalText=e,t.textContent=e.replace(/\s[\u0660-\u0669]+﴾/,"﴾")))}))}function toggleQuranBrackets(){showQuranBrackets=!showQuranBrackets,document.querySelectorAll("td").forEach((t=>{const e=t.textContent;(e.match(/﴿.*﴾/)||t.dataset.originalWithBrackets)&&(showQuranBrackets?t.textContent=`﴿${t.textContent}﴾`:(t.dataset.originalWithBrackets=e,t.textContent=e.replace(/[﴿﴾]/g,"")))}))}let currentSurah=1,currentAyah=1,currentJuz=1,currentFocus=-1,additionalColumns=[],defaultColumns=[0],translationStates={},initialTranslationStates={},lastFocusedItems={surah:-1,ayah:-1,juz:-1},searchInputValues={surah:"",ayah:"",juz:""};const baseJsonUrl="../js/json/",maxSurah=114,maxJuz=30,baseColumns=[{data:"0",title:"ޖުޒް",visible:!1},{data:"1",title:"ސޫރަތް",visible:!1},{data:"2",title:"އާޔަތް #",visible:!1},{data:"3",title:"ބިސްމި",visible:!0},{data:"4",title:"އާޔަތް (ރަސްމު އިމްލާއީ)",visible:!0,render:function(t,e,n){return replaceDigitsWithArabic("﴿"+t.replace(/\s([\u0660-\u0669]+)/," ")+" "+n[2]+"﴾")}}],additionalJsons=[{name:"quranData_rasmUthmani",columns:[0],title:"ރަސްމު އުޘްމާނީ:"},{name:"quranHadithmv",columns:[0],title:"ޙަދީޘްއެމްވީ ތަރުޖަމާ:"},{name:"quranRasmee",columns:[0,1],title:"ރަސްމީ ތަރުޖަމާ:"},{name:"quranBakurube",columns:[0,1],title:"ބަކުރުބެގެ ތަރުޖަމާ:"},{name:"quranJaufar",columns:[0,1],title:"ޖަޢުފަރުގެ ތަފްސީރު:"},{name:"quranSoabuni",columns:[0,1,2,3],title:"ޞގެ ތަފްސީރު:"},{name:"quranMukhtasar",columns:[0],title:"مختصر التفسير:"},{name:"quranMuyassar",columns:[0],title:"التفسير الميسر:"}];function replaceDigitsWithArabic(t){return t.replace(/[0-9]/g,(function(t){return arabicDigits[t]}))}function removeDiacritics(t){return t.replace(/[َُِّْٰۡۚٓـًٌٍّٔ]/g,"")}function prepareArabicText(t){return normalizeChars(t=(t=removeDiacritics(t)).replace(/سورة|سوره/g,"").replace(/^ال/g,"").trim())}defaultAdditionalJson=currentFileName;const charNormalizationMap={"أ":"ا","آ":"ا","إ":"ا","ٱ":"ا","ؤ":"و","ة":"ه","ئ":"ى","ޘ":"ސ","ޙ":"ހ","ޛ":"ޒ","ޜ":"ޒ","ޞ":"ސ","ޠ":"ތ","ޡ":"ޒ","ޢ":"އ","ޤ":"ގ","ޥ":"ވ"};function normalizeChars(t){return t.split("").map((t=>charNormalizationMap[t]||t)).join("")}function QtoggleDropdown(t){var e=$(`#${t}Dropdown`);if($(".q-dropdown").not(e).hide(),e.toggle().is(":visible")){var n=parseInt($(`#${t}Value`).text());const a=e.find(".q-dropdown-item");(n=a.filter(`[data-value="${n}"]`)).length&&(currentFocus=a.index(n),n[0].scrollIntoView({block:"center"}),removeActive(a),n.addClass("active")),e.find(".q-dropdown-search").val(searchInputValues[t]).focus()}}function QnavigateArrow(t,e){if("surah"===t)var n=currentSurah,a=114;else"ayah"===t?(n=currentAyah,a=ayahCounts[currentSurah]||1):"juz"===t&&(n=currentJuz,a=30);"prev"===e?1>--n&&("ayah"===t?(currentSurah--,1>currentSurah&&(currentSurah=114),updateAyahDropdown(),n=ayahCounts[currentSurah]||1):n=a):++n>a&&("ayah"===t&&(currentSurah++,114<currentSurah&&(currentSurah=1),updateAyahDropdown()),n=1),updateQValue(t,n)}function navigateToVerse(){const t=table.rows().indexes().filter((t=>(t=table.row(t).data(),null!==currentJuz?parseInt(t[0])===currentJuz:null!==currentSurah&&null!==currentAyah&&parseInt(t[1])===currentSurah&&parseInt(t[2])===currentAyah)));if(0<t.length){var e=table.page.info();table.page(Math.floor(t[0]/e.length)).draw(!1),(e=table.row(t[0]).node())&&e.scrollIntoView({behavior:"smooth",block:"center"}),updateAllQValues(table.row(t[0]).data())}}function updateQValue(t,e){e=parseInt(e);const n=$(`#${t}Value`);switch(t){case"surah":n.text(`${e} ${arabicSurahNames[e]}`),currentSurah=e,currentAyah=1,initializeQDropdown("ayah",1,ayahCounts[currentSurah]),$("#ayahValue").text(currentAyah),currentJuz=null;break;case"ayah":currentAyah=e,n.text(e),currentJuz=null;break;case"juz":currentJuz=e,n.text(e),currentAyah=currentSurah=null}navigateToVerse(),t=$(`#${t}Dropdown`).find(".q-dropdown-item"),currentFocus=t.index(t.filter(`[data-value="${e}"]`))}function updateAllQValues(t){currentJuz=parseInt(t[0]),currentSurah=parseInt(t[1]),currentAyah=parseInt(t[2]),$("#juzValue").text(currentJuz),$("#surahValue").text(`${currentSurah} ${arabicSurahNames[currentSurah]}`),$("#ayahValue").text(currentAyah)}function updateAyahDropdown(){initializeQDropdown("ayah",1,ayahCounts[currentSurah]||1),$("#ayahValue").text("1")}function initializeQDropdown(t,e,n){const a=$(`#${t}Dropdown`);for(a.empty(),a.append(`<input type="text" class="q-dropdown-search" placeholder="${"ސޫރަތް:"===a.closest(".q-nav-box").find(".q-nav-label").text()?"ސޫރަތުގެ ނަން ނުވަތަ ނަމްބަރު ލިޔޭ":"އާޔަތް:"===a.closest(".q-nav-box").find(".q-nav-label").text()?"އާޔަތް ނަމްބަރު ލިޔޭ":"ޖުޒް ނަމްބަރު ލިޔޭ"}">`),"ayah"===t&&(n=ayahCounts[currentSurah]);e<=n;e++){let n=e;"surah"===t&&(n=`${e} ${arabicSurahNames[e]} ${dhivehiSurahNames[e]} ${englishSurahNames[e]}`),a.append(`<div class="q-dropdown-item" data-value="${e}">${n}</div>`)}a.on("click",".q-dropdown-item",(function(){const e=$(this).data("value");updateQValue(t,e),lastFocusedItems[t]=a.find(".q-dropdown-item").index(this),a.hide()})),(n=a.find(".q-dropdown-search")).on("input",(function(){const t=prepareArabicText(this.value.toLowerCase()).split(/\s+/);a.find(".q-dropdown-item").each((function(){const e=$(this),n=prepareArabicText(e.text().toLowerCase());t.every((t=>n.includes(t)))?e.show():e.hide()})),currentFocus=-1})),n.on("keydown",(function(t){const e=a.find(".q-dropdown-item:visible"),n=e.length;if(0!==n){switch(t.keyCode){case 40:t.preventDefault(),currentFocus=0>currentFocus?0:Math.min(currentFocus+1,n-1);break;case 38:t.preventDefault(),currentFocus=Math.max(currentFocus-1,0);break;case 13:return t.preventDefault(),0>currentFocus&&0<n&&(currentFocus=0),void(0<=currentFocus&&currentFocus<n&&e.eq(currentFocus).click())}removeActive(e),0<=currentFocus&&(e.eq(currentFocus).addClass("active"),e[currentFocus].scrollIntoView({block:"nearest"}))}}))}function addActive(t){if(!t)return!1;removeActive(t),$(t[currentFocus]).addClass("active"),$(t[currentFocus])[0].scrollIntoView({block:"nearest",inline:"nearest"})}function removeActive(t){t.removeClass("active")}function initializeNavigationBoxes(){initializeQDropdown("surah",1,114),initializeQDropdown("juz",1,30),updateAyahDropdown(),$(".q-nav-value").on("click",(function(){QtoggleDropdown($(this).attr("id").replace("Value",""))})),$(".q-nav-arrow").on("click",(function(){QnavigateArrow($(this).data("type"),$(this).data("direction"))})),$(document).on("click",(function(t){$(t.target).closest(".q-nav-box").length||$(".q-dropdown").hide()})),$(".q-dropdown").on("hide",(function(){var t=$(this).attr("id").replace("Dropdown","");searchInputValues[t]=$(this).find(".q-dropdown-search").val()}))}function getAllColumnDefinitions(){const t=additionalJsons.flatMap((t=>[{title:`<strong>${t.title}</strong>`,data:null,name:`${t.name}-title`,visible:!1,render:function(e,n,a){return`<strong>${t.title}</strong>`}},...t.columns.map(((e,n)=>({title:`${n+1}`,data:null,name:`${t.name}-${e}`,visible:!1,render:function(n,a,r){return r[t.name]&&void 0!==r[t.name][e]?"quranSoabuni"===t.name&&1===e&&"-"===r[t.name][e]?"ކުރިއަށް އޮތް އާޔަތުގެ ތަފްސީރު ބައްލަވާ":""===r[t.name][e]?"":r[t.name][e].replace(/\n/g,"<br>"):"ތައްޔާރުވަނީ..."}})))]));return[...baseColumns,...t]}function toggleTranslation(t,e){var n=additionalJsons.find((e=>e.name===t));const a=getColumnIndices(t),r=a[0],o=a[e+1],i=table.page();additionalColumns.includes(t)?(n=n.columns.filter(((t,e)=>table.column(a[e+1]).visible())),table.column(r).visible(!(1===n.length&&e===n[0]-1)),table.column(o).visible(!table.column(o).visible()),table.draw(),table.page(i).draw("page")):(additionalColumns.push(t),$.getJSON(`${baseJsonUrl}${t}.json`,(function(e){const n=table.data().toArray();n.forEach(((n,a)=>{n[t]=e[a]})),originalData=originalData.map(((n,a)=>((n=Array.isArray(n)?[...n]:Object.values(n))[t]=e[a],n))),table.clear().rows.add(n).draw(),table.column(r).visible(!0),table.column(o).visible(!0),table.page(i).draw("page")})).fail((function(t,e,n){console.error("Error loading translation:",n)})))}function getColumnIndices(t){let e=baseColumns.length;for(let n=0;n<additionalJsons.length&&additionalJsons[n].name!==t;n++)e+=additionalJsons[n].columns.length+1;return[e,...additionalJsons.find((e=>e.name===t)).columns.map(((t,n)=>e+n+1))]}function showAllTranslations(){document.querySelectorAll('#translationList input[type="checkbox"]').forEach((t=>{t.checked=!0,translationStates[t.value]=!0}))}function initializeTranslationSelector(){const t=document.getElementById("translationList"),e=document.getElementById("translationToggleBtn"),n=document.getElementById("translationDropdown"),a=document.getElementById("applyTranslations"),r=document.getElementById("resetTranslations"),o=document.getElementById("showAllTranslations"),i=document.getElementById("showMainTranslations");e&&n?(baseColumns.forEach(((e,n)=>{addTranslationItem(t,e.title,n,e.visible)})),additionalJsons.forEach((e=>{e.columns.forEach(((n,a)=>{addTranslationItem(t,`${e.title} ${a+1}`,`${e.name}-${n}`,e.name===defaultAdditionalJson&&0===a)}))})),e.addEventListener("click",(t=>{t.stopPropagation(),n.classList.toggle("active")})),document.addEventListener("click",(t=>{!t.target.closest(".translation-selector")&&n.classList.contains("active")&&(applyTranslations(),n.classList.remove("active"))})),a.addEventListener("click",(()=>{applyTranslations(),n.style.display="none"})),r.addEventListener("click",resetTranslations),o.addEventListener("click",showAllTranslations),i.addEventListener("click",showMainTranslations)):console.error("Toggle button or dropdown not found")}function showMainTranslations(){const t="ބިސްމި;އާޔަތް (ރަސްމު އިމްލާއީ);ޙަދީޘްއެމްވީ ތަރުޖަމާ: 1;ރަސްމީ ތަރުޖަމާ: 1;ބަކުރުބެގެ ތަރުޖަމާ: 2;ޖަޢުފަރުގެ ތަފްސީރު: 1;ޞގެ ތަފްސީރު: 2".split(";");document.querySelectorAll('#translationList input[type="checkbox"]').forEach((e=>{const n=e.nextElementSibling.textContent.trim();e.checked=t.includes(n),translationStates[e.value]=e.checked}))}function addTranslationItem(t,e,n,a){const r=document.createElement("div");if(r.className="translation-item",!String(n).includes("-title")){let o=!1;if("string"==typeof n&&n.includes("-")){const[t,e]=n.split("-");o=t===defaultAdditionalJson&&defaultColumns.includes(parseInt(e))}r.innerHTML=`\n      <input type="checkbox" id="trans-${n}" value="${n}" ${a||o?"checked":""}>\n      <label for="trans-${n}">${e}</label>\n    `,t.appendChild(r),translationStates[n]=a||o,initialTranslationStates[n]=a||o}}function applyTranslations(){const t=table.page();document.querySelectorAll('#translationList input[type="checkbox"]').forEach((t=>{const e=t.value;if(t=t.checked,"string"==typeof e&&e.includes("-")){const[n,a]=e.split("-");t!==table.column(getColumnIndices(n)[parseInt(a)+1]).visible()&&toggleTranslation(n,parseInt(a))}else table.column(parseInt(e)).visible(t);translationStates[e]=t})),additionalJsons.forEach((t=>{var e=getColumnIndices(t.name);t=e[0],e=e.slice(1).some((t=>table.column(t).visible())),table.column(t).visible(e)})),table.draw(),table.page(t).draw("page"),scrollUpTop()}function resetTranslations(){document.querySelectorAll('#translationList input[type="checkbox"]').forEach((t=>{t.checked=initialTranslationStates[t.value]||!1}))}function toggleBaseColumn(t){const e=table.column(t);e.visible(translationStates[t]),baseColumns[t].visible=e.visible()}function createTranslationSelector(){const t=document.getElementsByClassName("translation-selector-widget");t.length&&(Array.from(t).forEach((t=>{t.innerHTML='\n  <div class="translation-selector">\n    <button id="translationToggleBtn" class="customButtons">\n      ⭐ ތަރުޖަމާތައް / ތަފްސީރުތައް\n    </button>\n\n    <div id="translationDropdown" class="translation-dropdown">\n      <div class="translation-buttons-container">\n        <button id="showMainTranslations">މައި</button>\n        <button id="showAllTranslations">ހުރިހާ</button>\n        <button id="resetTranslations">ރީސެޓް</button>\n        <button id="applyTranslations">އޯކޭ</button>\n      </div>\n      <div class="translation-list-wrapper">\n        <div id="translationList"></div>\n      </div>\n    </div>\n  </div>\n'})),initializeTranslationSelector())}function createNavigationBoxes(){const t=document.getElementById("quran-navigation-widget");if(t){var e=document.createElement("div");e.className="q-navigation-container",[{type:"surah",label:"ސޫރަތް"},{type:"ayah",label:"އާޔަތް"},{type:"juz",label:"ޖުޒް"}].forEach((({type:t,label:n})=>{e.insertAdjacentHTML("beforeend",`\n      <div class="q-nav-box">\n        <span class="q-nav-label">${n}:</span>\n        <span class="q-nav-arrow" data-type="${t}" data-direction="prev">▶</span>\n        <div class="q-nav-value" id="${t}Value">1</div>\n        <span class="q-nav-arrow" data-type="${t}" data-direction="next">◀</span>\n        <div class="q-dropdown" id="${t}Dropdown"></div>\n      </div>\n    `)})),t.appendChild(e)}}document.addEventListener("DOMContentLoaded",createTranslationSelector),document.addEventListener("DOMContentLoaded",createNavigationBoxes);