<!DOCTYPE html>
<html lang="dv" class="notranslate" translate="no">
  <head>
    <meta name="google" content="notranslate" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loading...</title>

    <!-- Prevent FOUC - this must be inline -->
    <style>
      html {
        visibility: hidden;
        opacity: 0;
      }
    </style>

    <!-- Meta tags will be updated dynamically -->
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta itemprop="name" content="" />
    <meta itemprop="description" content="" />
    <meta itemprop="image" content="" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="" />

    <meta name="theme-color" content="" />

    <link rel="icon" href="../img/logo/logo.svg" type="image/svg+xml" />

    <!-- Load scripts -->
    <script type="module">
      import { siteConfig } from "../js/config.js";

      // Set static metadata
      document.querySelector('meta[name="description"]').content =
        siteConfig.description;
      document.querySelector('meta[name="keywords"]').content =
        siteConfig.keywords;
      document.querySelector('meta[itemprop="description"]').content =
        siteConfig.siteNameDv;
      document.querySelector('meta[itemprop="image"]').content =
        siteConfig.logo;
      document.querySelector('meta[property="og:type"]').content = "website";
      document.querySelector('meta[property="og:image"]').content =
        siteConfig.logo;
      document.querySelector('meta[name="theme-color"]').content =
        siteConfig.themeColor;

      // Add Google Analytics
      const gtagScript = document.createElement("script");
      gtagScript.src = `https://www.googletagmanager.com/gtag/js?id=${siteConfig.analytics.id}`;
      gtagScript.async = true;
      document.head.appendChild(gtagScript);

      const inlineScript = document.createElement("script");
      inlineScript.textContent = siteConfig.analytics.script;
      document.head.appendChild(inlineScript);
    </script>

    <!-- Load Marked.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- external resources-->

    <!-- to avoid FOUC -->
    <!-- <style>
      html {
        visibility: hidden;
        opacity: 0;
      }
    </style> -->

    <!-- <link
      rel="stylesheet"
      href="../css/base-styles.css"
      media="print"
      onload="this.media='all'"
    />  -->

    <link
      rel="stylesheet"
      href="../css/navbar.css"
      media="print"
      onload="this.media='all'"
    />
    <script src="../js/navbar.js"></script>

    <style>
      /* Basic styling */
      :root {
        /* Light theme variables */
        --bg-color: #ffffff;
        --text-color: #0a0a0a;
        --link-color: #2196f3;
        --border-color: #dddddd;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          /* Dark theme variables */
          --bg-color: #1a1b1e;
          --text-color: #e1e1e1;
          --link-color: #64b5f6;
          --border-color: #333333;
        }
      }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        line-height: 1.6;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: var(--bg-color);
        color: var(--text-color);
      }

      /* Style links */
      a {
        color: var(--link-color);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
        opacity: 0.8;
      }

      /* Style horizontal rules */
      hr {
        border: none;
        border-top: 1px solid var(--border-color);
        margin: 2em 0;
      }

      /* Style headings */
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        color: var(--text-color);
      }

      /* Add smooth transition for theme changes */
      * {
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      /* Skeleton screen animation */
      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      .skeleton {
        background: linear-gradient(
          90deg,
          var(--bg-color) 0px,
          rgb(99 99 99 / 20%) 50%,
          var(--bg-color) 100%
        );
        background-size: 1000px 100%;
        animation: shimmer 2s infinite linear;
      }

      .skeleton-text {
        height: 1em;
        margin: 0.5em 0;
        border-radius: 4px;
      }

      .skeleton-title {
        height: 2em;
        margin: 1em 0;
        width: 50%;
      }

      .skeleton-paragraph {
        height: 100px;
        margin: 1em 0;
      }

      /* Hide skeleton when content is loaded */
      .loaded .skeleton {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Navbar will be rendered here -->
    <div id="navbar-container"></div>

    <!-- Skeleton loader -->
    <div id="skeleton">
      <div class="skeleton skeleton-title"></div>
      <div class="skeleton skeleton-text"></div>
      <div class="skeleton skeleton-text"></div>
      <div class="skeleton skeleton-paragraph"></div>
      <div class="skeleton skeleton-text"></div>
      <div class="skeleton skeleton-text"></div>
      <div class="skeleton skeleton-paragraph"></div>
    </div>

    <!-- Content will be rendered here -->
    <div id="content" style="display: none"></div>

    <script>
      // Configure Marked options
      marked.setOptions({
        breaks: true,
        gfm: true,
      });

      // Function to show content and hide skeleton
      function showContent() {
        document.getElementById("skeleton").style.display = "none";
        document.getElementById("content").style.display = "block";
        document.body.classList.add("loaded");
        // Make page visible after content is ready
        document.documentElement.style.visibility = "visible";
        document.documentElement.style.opacity = "1";
      }

      // Wait for everything to load
      window.addEventListener("load", function () {
        // Fetch and render the Markdown file
        fetch("../page-uc/privacyPolicy.md")
          .then((response) => response.text())
          .then((markdown) => {
            // Extract first H1 header for title
            const titleMatch = markdown.match(/^#\s+(.+)$/m);
            if (titleMatch) {
              const pageTitle = titleMatch[1];
              document.title = pageTitle;
              document.querySelector('meta[itemprop="name"]').content =
                pageTitle;
              document.querySelector('meta[property="og:title"]').content =
                pageTitle;
            }

            document.getElementById("content").innerHTML =
              marked.parse(markdown);

            // Wait for web fonts to load - fixed Promise.all usage
            if (document.fonts && document.fonts.ready) {
              document.fonts.ready.then(() => {
                showContent();
              });
            } else {
              // Fallback if document.fonts is not supported
              showContent();
            }
          })
          .catch((error) => {
            console.error("Error loading the Markdown file:", error);
            document.getElementById("content").innerHTML =
              "<p>Error loading content.</p>";
            showContent();
          });
      });
    </script>
  </body>
</html>
